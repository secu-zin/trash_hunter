<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>λ¶„λ¦¬μκ±°μ λ‹¬μΈ</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='game_recycle.css') }}">
</head>
<body>
    <!-- β… ν°μƒ‰ λ°°κ²½ κµ¬κ°„ μ „μ²΄λ¥Ό κ°μ -->
  <div class="header-wrapper">
    <header class="main-header">
      <div class="logo-bg">
        <h1>Trash Hunter</h1>
        <img src="{{ url_for('static', filename='logo.png') }}" alt="λ°°κ²½λ΅κ³ " class="bg-logo">
      </div>
    </header>

    <nav class="main-nav">
      <ul>
        <li><a href="/cardnews">μΉ΄λ“ λ‰΄μ¤</a></li>
        <li><a href="/">ν™</a></li>
        <li><a href="/game">λ―Έλ‹ κ²μ„</a></li>
      </ul>
    </nav>
  </div>


  <!-- β… μΈνΈλ΅ ν™”λ©΄ -->
  <div class="intro-wrapper">
    <!-- μΈνΈλ΅ -->
    <div class="intro-screen" id="intro">
      <div class="intro-box">
        <p class="intro-text">μƒν™νκΈ°λ¬Ό μ¤‘μ— μ¬ν™μ©λλ” λ¬Όν’μ΄ μ–Όλ§λ‚ λ κΉμ”?</p>
        <h2 class="intro-title">μ—¬λ¬λ¶„μ λ¥λ ¥μ„ λ³΄μ—¬μ£Όμ„Έμ”!!</h2>
        <button class="start-button" id="start-btn"><span>β–¶</span> START</button>
        <div class="tip-box">
          <strong>GAME TIP</strong><br />
          μ£Όμ–΄μ§„ μ‹κ°„ λ‚΄μ— λ¨λ“  λ¶„λ¦¬μκ±° μ©ν’μ„ μ μ ν• μκ±°ν•¨μ— λ‹΄λ” κ²μ„μ…λ‹λ‹¤.<br />
          λΉ λ¥΄κ² μ²λ¦¬ν• μλ΅ λ³΄λ„μ¤ μ μλ¥Ό λ°›μ„ μ μμ–΄μ”.
        </div>
      </div>
    </div>

  <!-- β… κ²μ„ ν™”λ©΄ -->
  <div class="game-container" id="game" style="display: none;">
    <div class="game-header">
      <div class="level-box">1λ‹¨κ³„</div>
      <div class="center-logo"></div>
      <div class="score-box">
        <span class="score-change" id="score-change">+0</span>
        <span class="score" id="score">0μ </span>
      </div>
    </div>

    <div class="fall-zone" id="trash-container"></div>

    <div class="bins">
      <div class="bin" data-accept="paper">μΆ…μ΄</div>
      <div class="bin" data-accept="metal">μΊ”</div>
      <div class="bin" data-accept="glass">μ λ¦¬</div>
      <div class="bin" data-accept="plastic">ν”λΌμ¤ν‹±</div>
    </div>

    <div id="game-over" class="game-over"></div>
  </div>

  <script>
    const intro = document.getElementById("intro");
    const game = document.getElementById("game");
    const startBtn = document.getElementById("start-btn");

    const trashContainer = document.getElementById("trash-container");
    const scoreDisplay = document.getElementById("score");
    const scoreChange = document.getElementById("score-change");
    const gameOver = document.getElementById("game-over");

    let score = 0;
    let timeLeft = 20;
    let timer;

    startBtn.addEventListener("click", () => {
      intro.style.display = "none";
      game.style.display = "block";
      startGame();
    });

    function startGame() {
      score = 0;
      timeLeft = 20;
      updateScore(0);
      trashContainer.innerHTML = "";
      gameOver.textContent = "";

      for (let i = 0; i < 5; i++) addTrash();

      setUpBins();
      timer = setInterval(() => {
        timeLeft--;
        if (timeLeft <= 0) {
          clearInterval(timer);
          gameOver.textContent = `κ²μ„ μΆ…λ£! λ‹Ήμ‹ μ μ μλ” ${score}μ μ…λ‹λ‹¤.`;
        }
      }, 1000);
    }

    function updateScore(amount) {
      score += amount;
      scoreDisplay.textContent = `${score}μ `;
      scoreChange.textContent = (amount >= 0 ? "+" : "") + amount;
    }

    function addTrash() {
      const list = [
        { emoji: "π“„", type: "paper" },
        { emoji: "π¥¤", type: "plastic" },
        { emoji: "π¥«", type: "metal" },
        { emoji: "πΎ", type: "glass" },
      ];
      const item = list[Math.floor(Math.random() * list.length)];

      const el = document.createElement("div");
      el.className = "trash";
      el.textContent = item.emoji;
      el.dataset.type = item.type;
      el.draggable = true;

      el.addEventListener("dragstart", (e) => {
        e.dataTransfer.setData("type", el.dataset.type);
        e.dataTransfer.setData("id", el.textContent);
      });

      trashContainer.appendChild(el);
    }

    function setUpBins() {
      document.querySelectorAll(".bin").forEach(bin => {
        bin.addEventListener("dragover", e => e.preventDefault());
        bin.addEventListener("drop", e => {
          e.preventDefault();
          const type = e.dataTransfer.getData("type");
          const id = e.dataTransfer.getData("id");
          const el = [...document.querySelectorAll(".trash")].find(t => t.textContent === id);

          if (type === bin.dataset.accept) {
            updateScore(10);
          } else {
            updateScore(-5);
          }
          if (el) el.remove();
          addTrash();
        });
      });
    }
  </script>
</body>
</html>
