<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Trash Hunter - ë¶„ë¦¬ìˆ˜ê±° ê²Œì„</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <header class="main-header">
    <div class="logo-bg">
      <h1>Trash Hunter</h1>
      <img src="{{ url_for('static', filename='logo.png') }}" alt="ë°°ê²½ë¡œê³ " class="bg-logo">
    </div>
  </header>
  
  <nav>
    <ul>
      <li><a href="/cardnews">ì¹´ë“œ ë‰´ìŠ¤</a></li>
      <li><a href="/">í™ˆ</a></li>
      <li><a href="/game">ë¯¸ë‹ˆ ê²Œì„</a></li>
    </ul>
  </nav>

  <div id="start-screen">
    <h2>ì¬í™œìš© ê°€ëŠ¥í•œ ì“°ë ˆê¸°ë§Œ ë°›ì•„ì£¼ì„¸ìš”!</h2>
    <button id="start-btn">START</button>
  </div>

  <div id="game">
    <div id="score">ì ìˆ˜: 0</div>
    <div id="lives">â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸</div>
    <div id="timer">ë‚¨ì€ ì‹œê°„: 20ì´ˆ</div>
    <div class="player" id="player">ğŸ§º</div>
  </div>

  <div id="game-over" style="display: none;">
    <div id="final-message"></div>
    <button id="restart-btn">ë‹¤ì‹œ ì‹œì‘</button>
  </div>

  <script>
    const startBtn = document.getElementById('start-btn');
    const startScreen = document.getElementById('start-screen');
    const game = document.getElementById('game');
    const player = document.getElementById('player');
    const scoreBoard = document.getElementById('score');
    const livesBoard = document.getElementById('lives');
    const gameOverScreen = document.getElementById('game-over');
    const finalMessage = document.getElementById('final-message');
    const restartBtn = document.getElementById('restart-btn');
    const timerBoard = document.getElementById('timer');

    let score = 0;
    let lives = 5;
    let playerX = 400;
    let gameRunning = false;
    let gameTime = 20;
    let totalItems = 0;
    let correctItems = 0;

    const goodItems = [
      { emoji: 'ğŸ§´', label: 'í”Œë¼ìŠ¤í‹±' },
      { emoji: 'ğŸ«™', label: 'ìœ ë¦¬ë³‘' },
      { emoji: 'ğŸ“¦', label: 'ì¢…ì´' },
      { emoji: 'ğŸ”‹', label: 'ê±´ì „ì§€' },
      { emoji: 'ğŸ¥«', label: 'ìº”' }
    ];

    const badItems = [
      { emoji: 'ğŸ¦´', label: 'ìŒì‹ë¬¼ ë¼ˆ' },
      { emoji: 'ğŸª¥', label: 'ì¹«ì†”' },
      { emoji: 'ğŸ§»', label: 'íœ´ì§€' },
      { emoji: 'ğŸ§¦', label: 'ì–‘ë§' },
      { emoji: 'ğŸ‘', label: 'ì‹ ë°œ' },
      { emoji: 'ğŸ’„', label: 'í™”ì¥í’ˆ' }
    ];

    document.addEventListener('keydown', e => {
      if (!gameRunning) return;
      const speed = 30;
      if (e.key === 'ArrowLeft') playerX = Math.max(0, playerX - speed);
      else if (e.key === 'ArrowRight') playerX = Math.min(760, playerX + speed);
      player.style.left = `${playerX}px`;
    });

    function showFeedback(x, y, text, color) {
      const fb = document.createElement('div');
      fb.className = 'feedback';
      fb.textContent = text;
      fb.style.left = `${x}px`;
      fb.style.top = `${y}px`;
      fb.style.color = color;
      game.appendChild(fb);
      setTimeout(() => fb.remove(), 1000);
    }

    function createItem() {
      if (!gameRunning) return;
      const item = document.createElement('div');
      item.classList.add('item');
      const isGood = Math.random() > 0.4;
      const data = isGood
        ? goodItems[Math.floor(Math.random() * goodItems.length)]
        : badItems[Math.floor(Math.random() * badItems.length)];
      item.innerHTML = `${data.emoji}<div class="item-label">${data.label}</div>`;
      item.dataset.good = isGood;
      const x = Math.random() * 760;
      item.style.left = `${x}px`;
      game.appendChild(item);
      let y = 0;
      const fallSpeed = 1.5 + Math.random() * 2.5;
      const fall = setInterval(() => {
        if (!gameRunning) return clearInterval(fall);
        y += fallSpeed;
        item.style.top = `${y}px`;
        const itemX = x;
        const playerY = game.offsetHeight - 100;
        const itemBottom = y + 30;
        if (itemBottom >= playerY && itemX >= playerX - 50 && itemX <= playerX + 50) {
          clearInterval(fall);
          game.removeChild(item);
          totalItems++;
          if (item.dataset.good === 'true') {
            score++;
            correctItems++;
            showFeedback(itemX, y, '+1 âœ”ï¸', 'green');
          } else {
            lives--;
            showFeedback(itemX, y, 'âŒ', 'red');
          }
          updateUI();
        }
        if (y > game.offsetHeight) {
          clearInterval(fall);
          game.removeChild(item);
        }
      }, 16);
    }

    function updateUI() {
      scoreBoard.textContent = `ì ìˆ˜: ${score}`;
      livesBoard.textContent = 'â¤ï¸'.repeat(lives);
      if (lives <= 0) endGame();
    }

    function updateTimer() {
      timerBoard.textContent = `ë‚¨ì€ ì‹œê°„: ${gameTime}ì´ˆ`;
      if (gameTime <= 0) endGame();
    }

    function endGame() {
      gameRunning = false;
      gameOverScreen.style.display = 'flex';
      const percent = totalItems > 0 ? Math.round((correctItems / totalItems) * 100) : 0;
      finalMessage.innerHTML = `ê²Œì„ ì¢…ë£Œ!<br>ìµœì¢… ì ìˆ˜: ${score}<br>ì¬í™œìš© ì„±ê³µë¥ : ${percent}%`;
    }

    function startGame() {
      score = 0;
      lives = 5;
      gameTime = 40;
      totalItems = 0;
      correctItems = 0;
      updateUI();
      updateTimer();
      gameRunning = true;
      startScreen.style.display = 'none';
      gameOverScreen.style.display = 'none';
      player.style.left = `${playerX}px`;
      const loop = setInterval(() => {
        if (!gameRunning) return clearInterval(loop);
        createItem();
      }, 900);
      const countdown = setInterval(() => {
        if (!gameRunning) return clearInterval(countdown);
        gameTime--;
        updateTimer();
      }, 1000);
    }

    startBtn.onclick = startGame;
    restartBtn.onclick = startGame;
  </script>
</body>
</html>
